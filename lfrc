# Basic settings
set hidden true
set icons true

# File picker: write selection to output file and quit
cmd pick %{{
    out="$LF_SELECTION_OUTPUT"
    if [ -n "$out" ]; then
        if [ -n "$fs" ]; then
            printf '%s\n' $fs > "$out"
        else
            printf '%s\n' "$f" > "$out"
        fi
    fi
    lf -remote "send $id quit"
}}

# Fuzzy file picker: use fzf to select files with action keys
cmd fzfpick ${{
    sel=$(fd --type f --hidden 2>/dev/null | fzf -m \
        --expect=ctrl-v,enter \
        --preview 'bat --color=always {} 2>/dev/null || cat {}' \
        --header 'enter=pick, ctrl-v=nvim')

    key=$(echo "$sel" | head -1)
    files=$(echo "$sel" | tail -n +2)

    [ -z "$files" ] && exit 0

    case "$key" in
        ctrl-v)
            # Open in nvim in a new full-size (tiled) terminal, then quit lf
            abs_files=$(echo "$files" | while read -r f; do printf '%s/%s\n' "$PWD" "$f"; done)
            wezterm start --cwd "$PWD" -- nvim $abs_files 2>/dev/null
            lf -remote "send $id quit"
            ;;
        enter|"")
            # Pick and quit
            out="$LF_SELECTION_OUTPUT"
            if [ -n "$out" ]; then
                printf '%s\n' "$files" | while read -r file; do
                    printf '%s/%s\n' "$PWD" "$file"
                done > "$out"
                lf -remote "send $id quit"
            fi
            ;;
    esac
}}

# Map enter to pick
map <enter> pick
map l pick
map / fzfpick

# Toggle selection with v (vim-style)
map v :toggle; down

# Leader key mappings (space)
map <space>   # clear default space binding
map <space>f cd /home/n0ko/datadog_terraform/forest/
map <space>p cd /home/n0ko/Portfolio/
map <space>d cd /home/n0ko/Downloads/

# Escape to quit without selecting
map <esc> quit
